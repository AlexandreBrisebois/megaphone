{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "api-name": {
            "type": "string"
        },
        "apim-service-name": {
            "type": "string"
        },
        "backend-service-url": {
            "type": "string"
        },
        "logger-name": {
            "type": "string"
        }
    },
    "functions": [],
    "variables": {},
    "resources": [
        {
            "type": "Microsoft.ApiManagement/service/apis",
            "apiVersion": "2019-12-01",
            "name": "[concat(parameters('apim-service-name'), '/', parameters('api-name'))]",
            "dependsOn": [],
            "properties": {
                "displayName": "Megaphone API",
                "apiRevision": "1",
                "subscriptionRequired": false,
                "serviceUrl": "[parameters('backend-service-url')]",
                "protocols": [
                    "https"
                ],
                "apiRevisionDescription": "Version 1 : Megaphone API",
                "apiVersion": "v1",
                "apiVersionSetId": "[concat('/api-version-sets/', 'megaphone-api-version-set')]",
                "isCurrent": true,
                "path": "/"
            }
        },    
        {
            "type": "Microsoft.ApiManagement/service/apis/schemas",
            "apiVersion": "2019-12-01",
            "name": "[concat(parameters('apim-service-name'), '/', parameters('api-name'), '/schema-components-json')]",
            "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service/apis', parameters('apim-service-name'), parameters('api-name'))]"
            ],
            "properties": {
                "contentType": "application/vnd.oai.openapi.components+json",
                "document": {}
            }
        },
        {
            "type": "Microsoft.ApiManagement/service/apis/operations",
            "apiVersion": "2019-12-01",
            "name": "[concat(parameters('apim-service-name'), '/', parameters('api-name'),'/list-feeds')]",
            "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service/apis', parameters('apim-service-name'), parameters('api-name'))]"
            ],
            "properties": {
                "displayName": "List Feeds",
                "method": "GET",
                "urlTemplate": "/api/feeds",
                "templateParameters": [],
                "responses": [
                    {
                        "statusCode": 200,
                        "representations": [
                            {
                                "contentType": "application/json",
                                "sample": "{\r\n    \"feeds\": [{\r\n        \"display\": \"Azure service updates\",\r\n        \"url\": \"https://azure.microsoft.com/en-us/roadmap/feed/\",\r\n        \"links\": [{\r\n            \"rel\": \"self\",\r\n            \"href\": \"api/feeds/740f3d2f-2eb2-50e4-b695-aeed86dfe674\",\r\n            \"method\": \"GET\"\r\n        }, {\r\n            \"rel\": \"delete\",\r\n            \"href\": \"api/feeds/740f3d2f-2eb2-50e4-b695-aeed86dfe674\",\r\n            \"method\": \"DELETE\"\r\n        }]\r\n    }, {\r\n        \"display\": \".NET Blog\",\r\n        \"url\": \"https://devblogs.microsoft.com/dotnet/feed/\",\r\n        \"links\": [{\r\n            \"rel\": \"self\",\r\n            \"href\": \"api/feeds/c50f7543-6b69-5e46-ae5e-bf0b82dede0e\",\r\n            \"method\": \"GET\"\r\n        }, {\r\n            \"rel\": \"delete\",\r\n            \"href\": \"api/feeds/c50f7543-6b69-5e46-ae5e-bf0b82dede0e\",\r\n            \"method\": \"DELETE\"\r\n        }]\r\n    }, {\r\n        \"display\": \"Microsoft Azure Blog\",\r\n        \"url\": \"https://azure.microsoft.com/en-us/blog/feed/\",\r\n        \"links\": [{\r\n            \"rel\": \"self\",\r\n            \"href\": \"api/feeds/466ca634-f0b6-5d29-9e8c-e04ab08a9a22\",\r\n            \"method\": \"GET\"\r\n        }, {\r\n            \"rel\": \"delete\",\r\n            \"href\": \"api/feeds/466ca634-f0b6-5d29-9e8c-e04ab08a9a22\",\r\n            \"method\": \"DELETE\"\r\n        }]\r\n    }, {\r\n        \"display\": \"Open Source Blog\",\r\n        \"url\": \"https://cloudblogs.microsoft.com/opensource/feed/\",\r\n        \"links\": [{\r\n            \"rel\": \"self\",\r\n            \"href\": \"api/feeds/013f232c-b274-56fe-8feb-a037535d2dd4\",\r\n            \"method\": \"GET\"\r\n        }, {\r\n            \"rel\": \"delete\",\r\n            \"href\": \"api/feeds/013f232c-b274-56fe-8feb-a037535d2dd4\",\r\n            \"method\": \"DELETE\"\r\n        }]\r\n    }],\r\n    \"updated\": \"2020-07-08T01:20:07.1715189+00:00\",\r\n    \"links\": [{\r\n        \"rel\": \"self\",\r\n        \"href\": \"api/feeds\",\r\n        \"method\": \"GET\"\r\n    }]\r\n}",
                                "schemaId": "schema-components-json",
                                "typeName": "feed-list"
                            }
                        ],
                        "headers": []
                    }
                ]
            }
        },
        {
            "type": "Microsoft.ApiManagement/service/apis/operations",
            "apiVersion": "2019-12-01",
            "name": "[concat(parameters('apim-service-name'), '/', parameters('api-name'), '/list-resources-by-date')]",
            "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service/apis', parameters('apim-service-name'), parameters('api-name'))]"
            ],
            "properties": {
                "displayName": "List Resources by Date",
                "method": "GET",
                "urlTemplate": "/api/resources/{year}/{month}/{day}",
                "templateParameters": [
                    {
                        "name": "year",
                        "required": true,
                        "values": [],
                        "type": "int"
                    },
                    {
                        "name": "month",
                        "required": true,
                        "values": [],
                        "type": "int"
                    },
                    {
                        "name": "day",
                        "required": true,
                        "values": [],
                        "type": "int"
                    }
                ],
                "responses": [
                    {
                        "statusCode": 200,
                        "representations": [
                            {
                                "contentType": "application/json",
                                "sample": "{\r\n    \"resources\": [{\r\n        \"display\": \"Azure Load Balancer support for IP-based backend pool management is in preview\",\r\n        \"url\": \"https://azure.microsoft.com/en-us/updates/previewlbip/\",\r\n        \"links\": []\r\n    }, {\r\n        \"display\": \"Azure Stream Analytics tools for Visual Studio Code now supports Visual Studio Codespaces\",\r\n        \"url\": \"https://azure.microsoft.com/en-us/updates/azure-stream-analyitcs-tools-for-vscode-supports-visual-studio-codespaces/\",\r\n        \"links\": []\r\n    }, {\r\n        \"display\": \"Upcoming changes to JSON flattening and storage for new Azure Time Series Insights deployments\",\r\n        \"url\": \"https://azure.microsoft.com/en-us/updates/azure-tsi-ingestion-rule-changes/\",\r\n        \"links\": []\r\n    }],\r\n    \"updated\": \"2020-07-08T01:29:11.4061331+00:00\",\r\n    \"date\": \"2020-07-07T00:00:00-04:00\",\r\n    \"links\": [{\r\n        \"rel\": \"self\",\r\n        \"href\": \"api/resources2020/7/7\",\r\n        \"method\": \"GET\"\r\n    }, {\r\n        \"rel\": \"prev\",\r\n        \"href\": \"api/resources2020/7/6\",\r\n        \"method\": \"GET\"\r\n    }, {\r\n        \"rel\": \"next\",\r\n        \"href\": \"api/resources2020/7/8\",\r\n        \"method\": \"GET\"\r\n    }]\r\n}",
                                "schemaId": "schema-components-json",
                                "typeName": "resource-list"
                            }
                        ],
                        "headers": []
                    }
                ]
            }
        },
        {
            "type": "Microsoft.ApiManagement/service/apis/operations",
            "apiVersion": "2019-12-01",
            "name": "[concat(parameters('apim-service-name'), '/', parameters('api-name'), '/list-resources-by-month')]",
            "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service/apis', parameters('apim-service-name'), parameters('api-name'))]"
            ],
            "properties": {
                "displayName": "List Resources by Month",
                "method": "GET",
                "urlTemplate": "/api/resources/{year}/{month}",
                "templateParameters": [
                    {
                        "name": "year",
                        "required": true,
                        "values": [],
                        "type": "int"
                    },
                    {
                        "name": "month",
                        "required": true,
                        "values": [],
                        "type": "int"
                    }
                ],
                "description": "List resources by month",
                "responses": [
                    {
                        "statusCode": 200,
                        "representations": [
                            {
                                "contentType": "application/json",
                                "sample": "[[{\r\n    \"resources\": [{\r\n        \"display\": \"Virtual machine scale sets\\u2014Automatic image upgrades for custom images now available\",\r\n        \"url\": \"https://azure.microsoft.com/en-us/updates/automatic-image-upgrade-for-custom-images-now-available-for-azure-vmss/\",\r\n        \"links\": []\r\n    }, {\r\n        \"display\": \"Azure Firewall Manager is now generally available\",\r\n        \"url\": \"https://azure.microsoft.com/en-us/updates/azure-firewall-manager-is-now-generally-available/\",\r\n        \"links\": []\r\n    }, {\r\n        \"display\": \"Azure Firewall Manager is now generally available\",\r\n        \"url\": \"https://azure.microsoft.com/en-us/blog/azure-firewall-manager-is-now-generally-available/\",\r\n        \"links\": []\r\n    }, {\r\n        \"display\": \"Build, distribute, and deploy application updates to Azure virtual machine scale sets\",\r\n        \"url\": \"https://azure.microsoft.com/en-us/blog/build-distribute-and-deploy-application-updates-to-azure-virtual-machine-scale-sets/\",\r\n        \"links\": []\r\n    }, {\r\n        \"display\": \"Announcing Azure Functions extension for Dapr\",\r\n        \"url\": \"https://cloudblogs.microsoft.com/opensource/2020/07/01/announcing-azure-functions-extension-for-dapr/\",\r\n        \"links\": []\r\n    }],\r\n    \"updated\": \"2020-07-08T01:29:15.6537848+00:00\",\r\n    \"date\": \"2020-07-01T00:00:00-04:00\",\r\n    \"links\": [{\r\n        \"rel\": \"self\",\r\n        \"href\": \"api/resources2020/7/1\",\r\n        \"method\": \"GET\"\r\n    }, {\r\n        \"rel\": \"prev\",\r\n        \"href\": \"api/resources2020/6/30\",\r\n        \"method\": \"GET\"\r\n    }, {\r\n        \"rel\": \"next\",\r\n        \"href\": \"api/resources2020/7/2\",\r\n        \"method\": \"GET\"\r\n    }]\r\n}, {\r\n    \"resources\": [{\r\n        \"display\": \"Disabling public network access for Azure IoT Hub will disable access to built-in Azure Event Hub endpoint on September 30, 2020\",\r\n        \"url\": \"https://azure.microsoft.com/en-us/updates/iot-hub-public-network-access-bug-fix/\",\r\n        \"links\": []\r\n    }, {\r\n        \"display\": \"Plan your migration to Azure VMware solution using Azure Migrate\",\r\n        \"url\": \"https://azure.microsoft.com/en-us/blog/plan-your-migration-to-azure-vmware-solution-using-azure-migrate/\",\r\n        \"links\": []\r\n    }],\r\n    \"updated\": \"2020-07-08T01:29:10.3466604+00:00\",\r\n    \"date\": \"2020-07-02T00:00:00-04:00\",\r\n    \"links\": [{\r\n        \"rel\": \"self\",\r\n        \"href\": \"api/resources2020/7/2\",\r\n        \"method\": \"GET\"\r\n    }, {\r\n        \"rel\": \"prev\",\r\n        \"href\": \"api/resources2020/7/1\",\r\n        \"method\": \"GET\"\r\n    }, {\r\n        \"rel\": \"next\",\r\n        \"href\": \"api/resources2020/7/3\",\r\n        \"method\": \"GET\"\r\n    }]\r\n}, {\r\n    \"resources\": [{\r\n        \"display\": \"Azure Virtual WAN: Multiple capabilities and new partners now generally available\",\r\n        \"url\": \"https://azure.microsoft.com/en-us/updates/azure-virtual-wan-multiple-capabilities-and-new-partners-now-generally-available/\",\r\n        \"links\": []\r\n    }],\r\n    \"updated\": \"2020-07-08T01:29:12.4653795+00:00\",\r\n    \"date\": \"2020-07-06T00:00:00-04:00\",\r\n    \"links\": [{\r\n        \"rel\": \"self\",\r\n        \"href\": \"api/resources2020/7/6\",\r\n        \"method\": \"GET\"\r\n    }, {\r\n        \"rel\": \"prev\",\r\n        \"href\": \"api/resources2020/7/5\",\r\n        \"method\": \"GET\"\r\n    }, {\r\n        \"rel\": \"next\",\r\n        \"href\": \"api/resources2020/7/7\",\r\n        \"method\": \"GET\"\r\n    }]\r\n}, {\r\n    \"resources\": [{\r\n        \"display\": \"Azure Load Balancer support for IP-based backend pool management is in preview\",\r\n        \"url\": \"https://azure.microsoft.com/en-us/updates/previewlbip/\",\r\n        \"links\": []\r\n    }, {\r\n        \"display\": \"Azure Stream Analytics tools for Visual Studio Code now supports Visual Studio Codespaces\",\r\n        \"url\": \"https://azure.microsoft.com/en-us/updates/azure-stream-analyitcs-tools-for-vscode-supports-visual-studio-codespaces/\",\r\n        \"links\": []\r\n    }, {\r\n        \"display\": \"Upcoming changes to JSON flattening and storage for new Azure Time Series Insights deployments\",\r\n        \"url\": \"https://azure.microsoft.com/en-us/updates/azure-tsi-ingestion-rule-changes/\",\r\n        \"links\": []\r\n    }],\r\n    \"updated\": \"2020-07-08T01:29:11.4061331+00:00\",\r\n    \"date\": \"2020-07-07T00:00:00-04:00\",\r\n    \"links\": [{\r\n        \"rel\": \"self\",\r\n        \"href\": \"api/resources2020/7/7\",\r\n        \"method\": \"GET\"\r\n    }, {\r\n        \"rel\": \"prev\",\r\n        \"href\": \"api/resources2020/7/6\",\r\n        \"method\": \"GET\"\r\n    }, {\r\n        \"rel\": \"next\",\r\n        \"href\": \"api/resources2020/7/8\",\r\n        \"method\": \"GET\"\r\n    }]\r\n}]",
                                "schemaId": "schema-components-json",
                                "typeName": "resource-list-collection"
                            }
                        ],
                        "headers": []
                    }
                ]
            }
        },
        {
            "type": "Microsoft.ApiManagement/service/apis/operations",
            "apiVersion": "2019-12-01",
            "name": "[concat(parameters('apim-service-name'), '/', parameters('api-name'), '/list-todays-resources')]",
            "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service/apis', parameters('apim-service-name'), parameters('api-name'))]"
            ],
            "properties": {
                "displayName": "List Today's Resources",
                "method": "GET",
                "urlTemplate": "/api/resources",
                "templateParameters": [],
                "description": "List today's resources",
                "responses": [
                    {
                        "statusCode": 200,
                        "representations": [
                            {
                                "contentType": "application/json",
                                "sample": "{\n    \"resources\": [{\n        \"display\": \"Azure Load Balancer support for IP-based backend pool management is in preview\",\n        \"url\": \"https://azure.microsoft.com/en-us/updates/previewlbip/\",\n        \"links\": []\n    }, {\n        \"display\": \"Azure Stream Analytics tools for Visual Studio Code now supports Visual Studio Codespaces\",\n        \"url\": \"https://azure.microsoft.com/en-us/updates/azure-stream-analyitcs-tools-for-vscode-supports-visual-studio-codespaces/\",\n        \"links\": []\n    }, {\n        \"display\": \"Upcoming changes to JSON flattening and storage for new Azure Time Series Insights deployments\",\n        \"url\": \"https://azure.microsoft.com/en-us/updates/azure-tsi-ingestion-rule-changes/\",\n        \"links\": []\n    }],\n    \"updated\": \"2020-07-08T01:29:11.4061331+00:00\",\n    \"date\": \"2020-07-07T00:00:00-04:00\",\n    \"links\": [{\n        \"rel\": \"self\",\n        \"href\": \"api/resources2020/7/7\",\n        \"method\": \"GET\"\n    }, {\n        \"rel\": \"prev\",\n        \"href\": \"api/resources2020/7/6\",\n        \"method\": \"GET\"\n    }, {\n        \"rel\": \"next\",\n        \"href\": \"api/resources2020/7/8\",\n        \"method\": \"GET\"\n    }]\n}",
                                "schemaId": "schema-components-json",
                                "typeName": "resource-list"
                            }
                        ],
                        "headers": []
                    }
                ]
            }
        },{
            "type": "Microsoft.ApiManagement/service/apis/diagnostics",
            "apiVersion": "2019-12-01",
            "name": "[concat(parameters('apim-service-name'), '/', parameters('api-name'),'/applicationinsights')]",
            "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service/apis', parameters('apim-service-name'), parameters('api-name'))]"   
            ],
            "properties": {
                "alwaysLog": "allErrors",
                "httpCorrelationProtocol": "W3C",
                "verbosity": "information",
                "logClientIp": true,
                "loggerId": "[resourceId('Microsoft.ApiManagement/service/loggers', parameters('apim-service-name'), parameters('logger-name'))]",
                "sampling": {
                    "samplingType": "fixed",
                    "percentage": 100
                },
                "frontend": {
                    "request": {
                        "headers": [],
                        "body": {
                            "bytes": 0
                        }
                    },
                    "response": {
                        "headers": [],
                        "body": {
                            "bytes": 0
                        }
                    }
                },
                "backend": {
                    "request": {
                        "headers": [],
                        "body": {
                            "bytes": 0
                        }
                    },
                    "response": {
                        "headers": [],
                        "body": {
                            "bytes": 0
                        }
                    }
                }
            }
        }
    ],
    "outputs": {}
}